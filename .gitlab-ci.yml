stages:
  - build
  - lint

variables:
  DOCKER_HOST: tcp://docker:2375

services:
  - name: docker:dind
    alias: docker
    command: ["--tls=false", "--host=tcp://0.0.0.0:2375"]

lint:
  stage: lint
  image: golangci/golangci-lint:latest
  allow_failure: true
  script:
    - golangci-lint run ./stat_service ./quiz_service ./auth_service ./api_gateway_service

build:
  stage: build
  image: docker:24.0
  before_script:
    - apk add --no-cache docker-compose
    - docker info
  script:
    - docker-compose config
    - docker-compose build
    - docker-compose up -d
    - docker-compose ps
  after_script:
    - docker-compose down -v